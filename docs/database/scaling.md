# Масштабирование БД

## Скалирование

>Скалирование баз данных - это процесс увеличения (или уменьшения) ее емкости или производительности для поддержания требуемого уровня обработки данных при росте нагрузки. Существует два основных типа скалирования: вертикальное (вверх) и горизонтальное (вширь).

### Вертикальное скалирование (Vertical Scaling):

**Вертикальное скалирование** включает увеличение мощности или ресурсов существующего сервера базы данных. 
Это может включать в себя увеличение объема оперативной памяти, добавление процессоров или увеличение емкости хранилища.

**Преимущества:**

* Простота в реализации.
* Меньше изменений в приложении.

**Недостатки:**

* Ограниченные пределы масштабирования.
* Большие затраты на оборудование.

### Горизонтальное скалирование (Horizontal Scaling):

**Горизонтальное скалирование** включает добавление дополнительных узлов (например, серверов) в инфраструктуру базы данных.
Каждый узел обрабатывает часть запросов, что позволяет распределить нагрузку.

**Преимущества:**

* Легкость распределения нагрузки.
* Возможность масштабирования в бесконечность.

**Недостатки:**

* Сложнее в управлении и настройке.
* Возможны сложности с консистентностью данных.


### Инструменты для скалирования баз данных:

**Шардинг:**

Разделение базы данных на несколько независимых фрагментов (шардов), каждый из которых обрабатывает свою часть данных.

**Репликация:**

Создание копий базы данных (реплик) для распределения запросов. Реплики могут использоваться для повышения отказоустойчивости или увеличения производительности чтения.

**Кэширование:**

Использование кэширования для хранения часто запрашиваемых данных в памяти, что уменьшает нагрузку на базу данных.

**Облачные сервисы:**

Использование облачных баз данных и сервисов, таких как Amazon RDS, Microsoft Azure SQL Database, Google Cloud SQL, предоставляющих масштабирование по запросу.

**Контейнеризация:**

Использование контейнерных технологий (например, Docker) для упаковки и масштабирования приложений с базами данных.

**Управление балансировкой нагрузки:**

Использование инструментов балансировки нагрузки для равномерного распределения запросов между узлами.

## Репликация

>Репликация баз данных - это процесс создания и поддержания точных копий данных, обычно между различными узлами системы, с целью повышения производительности, отказоустойчивости и облегчения нагрузки на основную базу данных. 

### Типы репликации:

**Мастер-Слейв (Master-Slave) репликация:**

Один сервер (мастер) содержит основные данные, а другие серверы (слейвы) имеют его копии. Все записи производятся на мастере, а слейвы получают обновления асинхронно.

**Мастер-Мастер (Master-Master) репликация:**

Оба сервера могут принимать записи и обновления, и изменения между ними синхронизируются. Это обеспечивает более высокую отказоустойчивость и распределение нагрузки.

**Централизованная и Децентрализованная репликация:**

Централизованная репликация управляется центральным сервером, который координирует процесс. В децентрализованной репликации каждый сервер заботится о собственном обновлении.

### Преимущества репликаций:

**Увеличение производительности:**

Распределение нагрузки между репликами позволяет увеличить пропускную способность системы и уменьшить задержки при запросах.

**Отказоустойчивость:**

В случае отказа основного сервера, реплика может быть использована для продолжения обслуживания запросов.

**Чтение с реплик:**

Реплики могут использоваться для чтения данных, что снижает нагрузку на мастер-сервер и улучшает производительность для операций чтения.

**Географическая распределенность:**

Репликация позволяет иметь копии данных на различных географических узлах, что улучшает доступность и снижает задержки при доступе к данным.

### Инструменты для настройки репликации:

**MySQL Replication:**

В MySQL мастер и слейвы могут быть настроены с использованием встроенной мастер-слейв репликации.

**PostgreSQL Streaming Replication:**

PostgreSQL предоставляет механизм поточной репликации для синхронизации данных между мастером и слейвами.

**MongoDB Replication:**

MongoDB поддерживает репликацию с использованием механизма "Replica Set", который включает мастер и несколько слейвов.

**SQL Server AlwaysOn Availability Groups:**

Microsoft SQL Server предоставляет функциональность AlwaysOn Availability Groups для настройки мастер-мастер репликации и обеспечения отказоустойчивости.

**Oracle Data Guard:**

Oracle предоставляет Data Guard для управления репликацией и обеспечения отказоустойчивости.

### Советы по использованию репликации:

**Тестирование:**

Проводите тестирование производительности и отказоустойчивости репликации перед внедрением в продакшн.

**Мониторинг:**

Установите системы мониторинга, чтобы следить за состоянием репликации и своевременно выявлять проблемы.

**Управление конфликтами:**

В случае мастер-мастер репликации управляйте возможными конфликтами данных.

**Шифрование и безопасность:**

Обеспечьте безопасность данных с использованием шифрования и других мер безопасности.

## Партицирование

> Партицирование баз данных - это метод, который позволяет разбивать большие таблицы на более мелкие и управляемые части, называемые "партициями". 
> Каждая партиция может быть обработана отдельно, что обеспечивает более эффективное управление данными.

### Типы партицирования:

**Разделение по диапазону (Range Partitioning):**

Данные разбиваются на партиции на основе диапазона значений определенного столбца. Например, таблица может быть разделена по диапазону дат.

**Разделение по списку (List Partitioning):**

Данные разбиваются на партиции на основе значений конкретного столбца. Каждая партиция связана с определенным списком значений.

**Хэш-партицирование (Hash Partitioning):**

Данные распределяются по партициям с использованием хэш-функции. Это обеспечивает равномерное распределение данных по различным партициям.

**Партицирование по подмножеству столбцов (Composite Partitioning):**

Комбинация двух или более методов партицирования. Например, можно использовать разделение по диапазону для одного столбца и хэш-партицирование для другого. 

### Преимущества партицирования:

**Улучшение производительности запросов:**

Партицирование позволяет системе обрабатывать только те данные, которые необходимы для выполнения запроса, что ускоряет выполнение запросов.

**Управление большими объемами данных:**

Партицирование облегчает управление и обслуживание больших таблиц, уменьшая время выполнения операций обслуживания и улучшая производительность.

**Облегчение архивации и удаления данных:**

Архивация и удаление данных из определенных партиций становится более эффективным и быстрым процессом.

**Повышение отказоустойчивости:**

При правильной настройке партицирования можно увеличить отказоустойчивость, поскольку возможно восстановление данных только в тех партициях, где произошла ошибка.

### Инструменты для настройки партицирования:

**MySQL Partitioning:**

MySQL поддерживает различные методы партицирования, такие как RANGE, LIST, и HASH. Для таблицы MySQL можно использовать ключевое слово PARTITION BY.

**Oracle Partitioning:**

Oracle Database предоставляет богатые возможности для партицирования, включая RANGE, LIST, HASH, и RANGE-LIST.

**SQL Server Partitioning:**

Microsoft SQL Server поддерживает разделение по диапазону (RANGE), по хэшу (HASH) и по списку (LIST).

**PostgreSQL Partitioning:**

PostgreSQL 11 и более поздние версии поддерживают диапазонное (RANGE) и списочное (LIST) партицирование.

### Советы по использованию партицирования:

* Выбор подходящего метода партицирования:
    * Выберите метод партицирования, наиболее соответствующий характеру данных и запросам.
* Управление индексами:
    * При использовании партицирования внимательно управляйте индексами, чтобы они соответствовали потребностям запросов.
* Мониторинг и оптимизация:
    * Регулярно мониторьте производительность и оптимизируйте стратегию партицирования при необходимости.
* Тестирование:
    * Перед внедрением в продакшн тщательно тестируйте стратегию партицирования для оценки производительности.


## Шардирование

> Шардирование (sharding) - это метод горизонтального масштабирования баз данных, при котором данные разбиваются на фрагменты, называемые шардами, которые могут быть распределены по разным серверам или узлам. Каждый шард обрабатывает только часть данных, что позволяет распределить нагрузку и улучшить производительность системы.

### Типы шардирования:

1. Горизонтальное шардирование (Horizontal Sharding):
    * Данные разбиваются по горизонтали, например, по значениям ключа, и каждый шард обрабатывает определенный диапазон значений.
2. Вертикальное шардирование (Vertical Sharding):
    * Разбиение данных происходит по вертикали, где каждый шард содержит определенные столбцы таблицы.
3. Функциональное шардирование (Functional Sharding):
    * Данные разбиваются на основе функциональных характеристик, например, на основе географического расположения или типа данных.

### Преимущества шардирования:

* Масштабируемость:
  * Шардирование обеспечивает возможность масштабирования базы данных горизонтально, добавляя новые шарды по мере необходимости.
* Распределение нагрузки:
  * Загрузка данных распределяется между различными шардами, что позволяет балансировать нагрузку и улучшать производительность.
* Увеличение отказоустойчивости:
  * Распределение данных между разными узлами обеспечивает отказоустойчивость. В случае сбоя одного узла, остальные продолжают обслуживать запросы.
* Эффективное использование ресурсов:
  * Ресурсы каждого шарда могут быть настроены независимо от других, что позволяет эффективно использовать аппаратное обеспечение.

### Советы по использованию шардирования:

* Хорошо продуманный ключ шардирования:
  * Выберите ключ для шардирования, который обеспечивает равномерное распределение данных и минимизирует запросы к нескольким шардам.
* Управление транзакциями:
  * Обрабатывайте транзакции в пределах одного шарда, так как распределенные транзакции могут быть сложными в управлении.
* Мониторинг и отладка:
  * Обеспечьте хороший мониторинг и средства отладки для отслеживания производительности и выявления проблем в распределенной среде.
* Резервное копирование и восстановление:
  * Имейте стратегию резервного копирования и восстановления, учитывая, что восстановление может потребовать синхронизации данных между шардами.